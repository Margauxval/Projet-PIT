        #!/usr/bin/env bash
        # start - Lance la bombe Projet-PIT (Arcanes) - version française
        set -euo pipefail
        ROOT="$(cd "$(dirname "$0")" && pwd)"
        MODULE_DIR="$ROOT/modules"
        SANCTUAIRE="$ROOT/sanctuaire"
        TIME_FILE="$ROOT/time"
        SEED_FILE="$ROOT/seed.conf"

        mkdir -p "$SANCTUAIRE"
        : > "$TIME_FILE"

        echo "=== Projet-PIT : Apprenti Bashicien ==="
        echo "Initialisation du sanctuaire..."
        bash "$ROOT/generate_seed.sh" "$SEED_FILE"

        # lire la configuration
        source "$SEED_FILE"

        echo "Temps imparti : ${BOMB_TIME}s. Erreurs autorisées : ${MAX_ERRORS}."
        echo "$BOMB_TIME" > "$TIME_FILE"

        # lancer le compte à rebours en arrière-plan
        bash "$ROOT/countdown.sh" "$TIME_FILE" &

        ERRORS=0
        for module in "${ACTIVE_MODULES[@]}"; do
          module_script="$MODULE_DIR/${module}.sh"
          if [ ! -x "$module_script" ]; then
            echo "Module manquant: $module"
            exit 1
          fi
          echo
          printf ">>> Lancement du module : %s
" "$module"
          SANDBOX_DIR="$SANCTUAIRE" bash "$module_script"
          rc=$?
          if [ $rc -ne 0 ]; then
            ERRORS=$((ERRORS+1))
            echo "Erreur comptée ! Total erreurs: $ERRORS / $MAX_ERRORS"
            if [ $ERRORS -ge $MAX_ERRORS ]; then
              echo
              echo "La bombe explose... ÉCHEC MAGIQUE."
              exit 2
            fi
          else
            echo "Module $module désamorcé."
          fi
        done

        # vérifier le temps restant
        if [ -f "$TIME_FILE" ]; then
          rem=$(cat "$TIME_FILE")
          if [ "$rem" -le 0 ]; then
            echo "Temps écoulé. La bombe explose."
            exit 3
          fi
        fi

        echo
        echo "Toutes les épreuves réussies. Tu obtiens le titre : Maître Bashicien !"
        exit 0
